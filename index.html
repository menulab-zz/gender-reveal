<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì  ë”ë¦¬ë¹Œ â€” ìŠ¤í¬ë˜ì¹˜ ê³µê°œ</title>
  <meta name="theme-color" content="#fff0f6" />
  <style>
    :root{
      --bg: #fffafc;
      --card: #ffffff;
      --muted:#6b7280;
      --accent:#ff4d8d;
      --maxw:920px;
      --radius:18px;
      font-family: "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: linear-gradient(180deg,#fff #fffafc);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      color:#111827;
    }
    .container{
      width:100%;
      max-width:var(--maxw);
      background:var(--card);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:0 18px 40px rgba(16,24,40,.08);
    }
    h1{margin:6px 0 4px;font-size:20px;text-align:center}
    p.lead{margin:0 0 14px;text-align:center;color:var(--muted)}
    .wrap{display:grid;grid-template-columns:1fr;gap:14px;align-items:start;}

    .card{
      position:relative;
      border-radius:14px;
      overflow:hidden;
      background:linear-gradient(180deg,#fff,#fff);
      border:1px solid rgba(0,0,0,.04);
      padding:18px;
      display:flex;
      gap:16px;
      align-items:center;
    }
    .left{
      flex:0 0 230px;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      justify-content:center;
      text-align:center;
    }
    .iconBottle{
      width:86px;height:86px;border-radius:999px;
      background:linear-gradient(180deg,#fff,#f8fafc);
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 8px 22px rgba(16,24,40,.06);
      border:1px solid rgba(0,0,0,.04);
    }
    .iconBottle svg{width:48px;height:48px}
    .hint{font-weight:800;font-size:15px;color:#111827;line-height:1.35;}
    .hintSmall{color:var(--muted);font-size:13px;line-height:1.45;}

    .scratchArea{
      position:relative;
      flex:1;
      height:380px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:12px;
      overflow:hidden;
      background:#f8fafc;
    }
    #revealImg{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }
    #scratchCanvas{
      position:absolute;
      left:0;top:0;width:100%;height:100%;
      touch-action:none;
    }

    .revealOverlay{
      position:absolute;
      left:0;top:0;width:100%;height:100%;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      pointer-events:none;
      opacity:0;transform:scale(.98);
      transition:opacity .28s ease, transform .28s ease;
      text-align:center;
      padding:16px;
    }
    .revealOverlay.show{opacity:1;transform:scale(1);}

    .revealTitle{
      font-size:34px;font-weight:1000;
      margin:6px 0 4px;
      background: linear-gradient(90deg,#ff6ea3,#ffb3d1);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      text-shadow: 0 10px 30px rgba(0,0,0,.08);
      letter-spacing:-.02em;
    }
    .revealSub{font-size:15px;color:var(--muted);margin-top:6px;}

    .controls{
      display:flex;
      gap:10px;
      justify-content:center;
      margin-top:8px;
      flex-wrap:wrap;
    }
    .btn{
      border-radius:12px;padding:10px 14px;border:none;font-weight:900;
      cursor:pointer;background:#111827;color:#fff;
      box-shadow:0 8px 20px rgba(17,24,39,.08);
    }
    .btn.ghost{background:transparent;color:#111827;border:1px solid rgba(0,0,0,.08);box-shadow:none;}
    footer.info{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}

    @media (max-width:820px){
      .card{flex-direction:column;gap:10px}
      .left{flex:0 0 auto}
      .scratchArea{height:330px}
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <h1>ìº¡í‹´ì´ì˜ ì„±ë³„ì´ ê¶ê¸ˆí•œê°€ìš”?</h1>
    <p class="lead">ì´ê³³ì„ ì‚´ì‚´ ê¸ì–´ì£¼ì„¸ìš” ğŸ«§</p>

    <div class="wrap">
      <div class="card" aria-live="polite">
        <div class="left">
          <div class="iconBottle" title="ì –ë³‘ ì•„ì´ì½˜">
            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="22" y="22" width="20" height="28" rx="3" fill="#fff"/>
              <path d="M30 12c1.2 0 2 .8 2 2v4h-4v-4c0-1.2.8-2 2-2z" fill="#ffd57a"/>
              <rect x="23" y="23" width="18" height="26" rx="2" fill="#f8fafc" stroke="#ffd57a" stroke-width="2"/>
            </svg>
          </div>

          <div class="hint">ìº¡í‹´ì´ì˜ ì„±ë³„ì´ ê¶ê¸ˆí•œê°€ìš”?<br/>ì´ê³³ì„ ì‚´ì‚´ ê¸ì–´ì£¼ì„¸ìš”</div>
          <div class="hintSmall">ì†ê°€ë½(ë˜ëŠ” ë§ˆìš°ìŠ¤)ìœ¼ë¡œ ê¸ìœ¼ë©´<br/>ì•„ë˜ ì´ë¯¸ì§€ê°€ ê³µê°œë¼ìš” ğŸ€</div>

          <div class="controls">
            <button class="btn" id="resetBtn" type="button">ë‹¤ì‹œ ìˆ¨ê¸°ê¸°</button>
            <button class="btn ghost" id="revealBtn" type="button">ë°”ë¡œ ê³µê°œ(í…ŒìŠ¤íŠ¸)</button>
          </div>
        </div>

        <div class="scratchArea">
          <!-- âœ… ê³µê°œë  ì´ë¯¸ì§€: ë¦¬í¬ì§€í† ë¦¬ ë£¨íŠ¸ì— baby.png ì—…ë¡œë“œ -->
          <img id="revealImg" src="baby.png" alt="ê³µê°œ ì´ë¯¸ì§€" />

          <!-- ê¸ê¸° ë ˆì´ì–´ -->
          <canvas id="scratchCanvas" aria-hidden="true"></canvas>

          <!-- ê³µê°œ í›„ ë©˜íŠ¸ -->
          <div class="revealOverlay" id="revealOverlay" role="status" aria-live="polite">
            <div style="font-size:42px; margin-bottom:6px;">ğŸ‰</div>
            <div class="revealTitle" id="revealText">ê³µì£¼ë‹˜ ì…ë‹ˆë‹¤!</div>
            <div class="revealSub">ìš°ë¦¬ ê°€ì¡±ì—ê²Œ ìƒˆë¡œìš´ ê¸°ì¨ì´ ì°¾ì•„ì™”ì–´ìš” ğŸ’–</div>
          </div>
        </div>
      </div>

      <footer class="info">
        (íŒ) ê¸ê¸°ê°€ ì˜ ì•ˆ ë˜ë©´ ë¸Œë¼ìš°ì €ë¥¼ ìµœì‹ ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜, í™”ë©´ì„ ì¡°ê¸ˆ ë” ë„“ê²Œ ì—´ì–´ë³´ì„¸ìš”.
      </footer>
    </div>
  </div>

  <script>
    // ===== ì„¤ì • =====
    const FINAL_TEXT = "ê³µì£¼ë‹˜ ì…ë‹ˆë‹¤!";   // âœ… ìš”ì²­ëŒ€ë¡œ ê³ ì •
    const RADIUS = 26;                    // ê¸ëŠ” ë¸ŒëŸ¬ì‹œ í¬ê¸°
    const CLEAR_THRESHOLD = 0.45;         // 45% ì´ìƒ ê¸ìœ¼ë©´ ìë™ ê³µê°œ

    const canvas = document.getElementById('scratchCanvas');
    const img = document.getElementById('revealImg');
    const overlay = document.getElementById('revealOverlay');
    const revealTextEl = document.getElementById('revealText');
    const resetBtn = document.getElementById('resetBtn');
    const revealBtn = document.getElementById('revealBtn');

    revealTextEl.textContent = FINAL_TEXT;

    let ctx, drawing = false;
    let lastX = 0, lastY = 0;

    function fitCanvas(){
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * devicePixelRatio;
      canvas.height = rect.height * devicePixelRatio;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';

      ctx = canvas.getContext('2d');
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);

      // ë®ê°œ ìƒ‰ (ìŠ¤í¬ë˜ì¹˜ ì½”íŒ… ëŠë‚Œ)
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = '#c4b7d6';
      ctx.fillRect(0,0,rect.width,rect.height);

      // ì•ˆë‚´ í…ìŠ¤íŠ¸(ì‚´ì§)
      ctx.fillStyle = 'rgba(255,255,255,0.10)';
      ctx.font = '900 28px "Noto Sans KR", sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('ì‚´ì‚´ ê¸ì–´ì£¼ì„¸ìš”', rect.width/2, rect.height/2);

      // ì´ì œë¶€í„°ëŠ” ì§€ìš°ê°œ ëª¨ë“œ
      ctx.globalCompositeOperation = 'destination-out';
      ctx.fillStyle = 'rgba(0,0,0,1)';
    }

    function erase(x,y){
      ctx.beginPath();
      ctx.arc(x,y,RADIUS,0,Math.PI*2);
      ctx.fill();
    }

    function pointerDown(e){
      drawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = (e.clientX ?? e.touches?.[0]?.clientX) - rect.left;
      lastY = (e.clientY ?? e.touches?.[0]?.clientY) - rect.top;
      erase(lastX, lastY);
    }

    function pointerMove(e){
      if(!drawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX ?? e.touches?.[0]?.clientX) - rect.left;
      const y = (e.clientY ?? e.touches?.[0]?.clientY) - rect.top;

      const dx = x - lastX, dy = y - lastY;
      const dist = Math.hypot(dx,dy);
      const step = Math.max(1, Math.floor(dist / (RADIUS/2)));

      for(let i=0;i<=step;i++){
        const ix = lastX + dx*(i/step);
        const iy = lastY + dy*(i/step);
        erase(ix,iy);
      }
      lastX = x; lastY = y;
    }

    function pointerUp(){
      drawing = false;
      requestAnimationFrame(checkClearPercent);
    }

    function checkClearPercent(){
      try{
        const w = canvas.width, h = canvas.height;

        // ê°€ë³ê²Œ ìƒ˜í”Œë§í•´ì„œ ì§€ì›Œì§„ ë¹„ìœ¨ ê³„ì‚°
        const sampleScale = 8;
        const sw = Math.max(20, Math.floor(w/sampleScale));
        const sh = Math.max(20, Math.floor(h/sampleScale));

        const small = document.createElement('canvas');
        small.width = sw; small.height = sh;
        const sctx = small.getContext('2d');
        sctx.drawImage(canvas, 0, 0, sw, sh);

        const data = sctx.getImageData(0,0,sw,sh).data;
        let cleared = 0;
        const total = sw*sh;

        for(let i=0;i<data.length;i+=4){
          const alpha = data[i+3];
          if(alpha === 0) cleared++;
        }

        const ratio = cleared / total;
        if(ratio >= CLEAR_THRESHOLD) triggerReveal();
      }catch(e){
        console.warn('checkClearPercent error', e);
      }
    }

    function triggerReveal(){
      overlay.classList.add('show');
      // ìº”ë²„ìŠ¤ë¥¼ ì „ë¶€ ì§€ì›Œì„œ ì™„ì „ ê³µê°œ
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }

    function resetScratch(){
      overlay.classList.remove('show');
      fitCanvas();
    }

    function attachEvents(){
      canvas.addEventListener('pointerdown', (e)=>{ e.preventDefault(); canvas.setPointerCapture(e.pointerId); pointerDown(e); }, {passive:false});
      canvas.addEventListener('pointermove', (e)=>{ if(e.buttons===1) pointerMove(e); }, {passive:false});
      canvas.addEventListener('pointerup', (e)=>{ canvas.releasePointerCapture?.(e.pointerId); pointerUp(); }, {passive:true});
      canvas.addEventListener('pointercancel', pointerUp);

      // touch fallback
      canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); pointerDown(e.touches[0]); }, {passive:false});
      canvas.addEventListener('touchmove', (e)=>{ e.preventDefault(); pointerMove(e.touches[0]); }, {passive:false});
      canvas.addEventListener('touchend', ()=>{ pointerUp(); }, {passive:true});

      resetBtn.addEventListener('click', resetScratch);
      revealBtn.addEventListener('click', triggerReveal);
      window.addEventListener('resize', ()=> setTimeout(fitCanvas,120));
    }

    function init(){
      fitCanvas();
      attachEvents();
    }

    if(img.complete){
      init();
    } else {
      img.addEventListener('load', init);
      img.addEventListener('error', ()=>{
        console.warn('baby.png ë¡œë“œ ì‹¤íŒ¨: ë¦¬í¬ì§€í† ë¦¬ ë£¨íŠ¸ì— baby.png ì—…ë¡œë“œí–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
      });
    }
  </script>
</body>
</html>
