<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì  ë”ë¦¬ë¹Œ ğŸ† í”ë“¤ë©´ ê³µê°œ!</title>
  <meta name="theme-color" content="#ffb6c1" />
  <style>
    :root{
      --bg1:#ffe6f2;
      --bg2:#e8f6ff;
      --card:#ffffffcc;
      --shadow: 0 20px 60px rgba(0,0,0,.12);
      --text:#1f2937;
      --muted:#6b7280;
      --btn:#111827;
      --btnText:#fff;
      --accent:#ff4d8d;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100svh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 20% 10%, var(--bg1), transparent 60%),
        radial-gradient(1100px 700px at 80% 20%, var(--bg2), transparent 60%),
        linear-gradient(180deg, #fff, #fff);
      overflow-x:hidden;
    }
    .wrap{
      max-width: 880px;
      margin: 0 auto;
      padding: 24px 18px 40px;
      position:relative;
    }
    .header{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-top: 10px;
      user-select:none;
    }
    .badge{
      padding: 6px 10px;
      border-radius:999px;
      background: #ffffffb3;
      border: 1px solid rgba(0,0,0,.06);
      backdrop-filter: blur(10px);
      font-weight:700;
      font-size:13px;
    }
    h1{
      margin: 18px 0 8px;
      text-align:center;
      font-size: 30px;
      letter-spacing: -.02em;
    }
    .sub{
      text-align:center;
      color:var(--muted);
      margin:0 0 18px;
      line-height:1.5;
    }
    .card{
      margin: 16px auto 0;
      background: var(--card);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(10px);
      position:relative;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 16px;
      align-items: center;
    }
    @media (max-width: 820px){
      .grid{grid-template-columns:1fr; }
    }
    .panel{
      padding: 16px;
      border-radius: 18px;
      background: #fff;
      border: 1px solid rgba(0,0,0,.06);
    }
    .big{
      font-size: 22px;
      font-weight: 800;
      margin: 0 0 8px;
    }
    .hint{
      margin: 0 0 14px;
      color: var(--muted);
      line-height: 1.55;
      font-size: 14px;
    }
    .ctaRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    button{
      appearance:none;
      border:none;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 800;
      cursor:pointer;
      background: var(--btn);
      color: var(--btnText);
      transition: transform .08s ease, opacity .2s ease;
    }
    button:active{ transform: scale(.98); }
    .ghost{
      background: transparent;
      color: var(--text);
      border: 1px solid rgba(0,0,0,.12);
    }
    .status{
      font-size: 13px;
      color: var(--muted);
    }
    .meterWrap{
      margin-top:12px;
      background: #f3f4f6;
      border-radius: 999px;
      overflow:hidden;
      height: 10px;
      border: 1px solid rgba(0,0,0,.06);
    }
    .meter{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #60a5fa, #f472b6, #fb7185);
      transition: width .12s ease;
    }

    /* Reveal */
    .reveal{
      display:none;
      text-align:center;
      padding: 20px 10px 8px;
    }
    .reveal.show{ display:block; }
    .title2{
      font-size: 16px;
      font-weight:800;
      color: var(--muted);
      margin: 0 0 8px;
    }
    .answer{
      font-size: 42px;
      font-weight: 1000;
      margin: 0 0 8px;
      letter-spacing: -.03em;
      text-shadow: 0 10px 25px rgba(0,0,0,.08);
    }
    .answer.prince{ color:#2f7cf6; }
    .answer.princess{ color:#ff4d8d; }
    .note{
      margin: 0 0 12px;
      color: var(--muted);
      font-size: 14px;
    }
    .babyArt{
      display:flex;
      justify-content:center;
      margin: 14px 0 10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.08);
      background:#ffffffd9;
      font-weight:800;
      font-size: 13px;
    }

    /* Floating hearts/stars */
    .float{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      border-radius: 22px;
    }
    .spark{
      position:absolute;
      font-size: 18px;
      opacity:.85;
      animation: rise 2.8s linear forwards;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.12));
    }
    @keyframes rise{
      0%{ transform: translateY(0) scale(1); opacity:.0; }
      10%{ opacity:.95; }
      100%{ transform: translateY(-260px) scale(1.15); opacity:0; }
    }

    /* Canvas fireworks */
    #fx{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 50;
      display:none;
    }
    #fx.show{ display:block; }

    /* Footer */
    .foot{
      text-align:center;
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      user-select:none;
    }
    code.inline{
      background:#1118270d;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,.06);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>
<canvas id="fx"></canvas>

<div class="wrap">
  <div class="header">
    <div class="badge">ğŸ‘¶ ì  ë”ë¦¬ë¹Œ</div>
    <div class="badge">ğŸ† í”ë“¤ë©´ ê³µê°œ</div>
    <div class="badge">ğŸ’– ì¶•í•˜í•´ì¤˜ìš”</div>
  </div>

  <h1>í•¸ë“œí°ì„ í”ë“¤ì–´ ë³´ì„¸ìš”!</h1>
  <p class="sub">
    <b>3ë²ˆ ì •ë„</b> í†¡í†¡ í”ë“¤ë©´â€¦ ğŸ‰<br/>
    (ì•„ì´í°ì€ <b>ì‹œì‘í•˜ê¸°</b> ë²„íŠ¼ì„ ë¨¼ì € ëˆŒëŸ¬ì•¼ í•´ìš”)
  </p>

  <div class="card">
    <div class="float" id="floatLayer"></div>

    <div class="grid">
      <div class="panel">
        <p class="big">ğŸ“£ ì¤€ë¹„ë˜ë©´ ì‹œì‘!</p>
        <p class="hint">
          ë²„íŠ¼ì„ ëˆ„ë¥¸ ë’¤ <b>í•¸ë“œí°ì„ í”ë“¤ë©´</b> â€œì™•ìë‹˜/ê³µì£¼ë‹˜â€ì´ ê³µê°œë˜ê³ 
          í­ì£½ íŒŒí‹°ê°€ í„°ì ¸ìš” ğŸ†
        </p>

        <div class="ctaRow">
          <button id="btnStart">ì‹œì‘í•˜ê¸°(ê¶Œí•œ í—ˆìš©)</button>
          <button class="ghost" id="btnTest">í…ŒìŠ¤íŠ¸ ê³µê°œ(í”ë“¤ê¸° ì—†ì´)</button>
          <button class="ghost" id="btnReset">ë¦¬ì…‹</button>
          <span class="status" id="status">ìƒíƒœ: ëŒ€ê¸° ì¤‘</span>
        </div>

        <div class="meterWrap" aria-label="shake meter">
          <div class="meter" id="meter"></div>
        </div>

        <div class="foot">
          í”ë“¤ê¸° ì¸ì‹ì´ ì˜ ì•ˆ ë˜ë©´: ì¼€ì´ìŠ¤ë¥¼ ì¡ê³  <b>ì§§ê²Œ</b> 2~3ë²ˆ í”ë“¤ì–´ë´ìš” ğŸ™Œ
        </div>
      </div>

      <div class="panel">
        <div class="reveal" id="reveal">
          <p class="title2">ë‘êµ¬ë‘êµ¬ë‘êµ¬â€¦</p>
          <p class="answer" id="answerText">ì™•ìë‹˜</p>

          <div class="babyArt" id="babyArt"></div>

          <p class="note" id="note">
            ìš°ë¦¬ ê°€ì¡±ì´ í•œ ëª… ë” ëŠ˜ì—ˆì–´ìš” ğŸ’•
          </p>

          <div class="pill" id="pill">
            ğŸ ì¶•í•˜ í•œë§ˆë”” ë‚¨ê²¨ì£¼ì„¸ìš”!
          </div>
        </div>

        <div id="placeholder" style="text-align:center; padding:18px 10px;">
          <div style="font-size:54px;">ğŸ¼</div>
          <div style="font-weight:900; margin-top:6px;">ì•„ì§ ë¹„ë°€ì´ì—ìš”</div>
          <div style="color:var(--muted); margin-top:6px; font-size:14px; line-height:1.5;">
            í”ë“¤ë©´ ê³µê°œ!<br/>
            í™”ë©´ ìœ„ í­ì£½ë„ ê¸°ëŒ€í•´ì¤˜ìš” ğŸ†
          </div>
          <div style="margin-top:10px; font-size:12px; color:var(--muted);">
            íŒíŠ¸: <code class="inline">ì™•ìë‹˜</code> / <code class="inline">ê³µì£¼ë‹˜</code>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="foot" style="margin-top:18px;">
    ë§Œë“  ì‚¬ëŒ: ìš°ë¦¬ ê°€ì¡± ğŸ’—
  </div>
</div>

<script>
  /**********************
   * 1) ì„¤ì •(ì—¬ê¸°ë§Œ ë°”ê¾¸ë©´ ë¨)
   **********************/
  // âœ… ì›í•˜ëŠ” ê²°ê³¼ë¡œ ë°”ê¿”ì¤˜: "prince" or "princess"
  // - ì™•ìë‹˜: "prince"
  // - ê³µì£¼ë‹˜: "princess"
  const REVEAL_RESULT = "prince";

  // ê³µê°œ ë¬¸êµ¬
  const LABELS = {
    prince: "ì™•ìë‹˜",
    princess: "ê³µì£¼ë‹˜"
  };

  /**********************
   * 2) UI ìš”ì†Œ
   **********************/
  const btnStart = document.getElementById("btnStart");
  const btnTest  = document.getElementById("btnTest");
  const btnReset = document.getElementById("btnReset");
  const statusEl = document.getElementById("status");
  const meterEl  = document.getElementById("meter");

  const revealEl = document.getElementById("reveal");
  const answerText = document.getElementById("answerText");
  const babyArt = document.getElementById("babyArt");
  const noteEl = document.getElementById("note");
  const placeholder = document.getElementById("placeholder");
  const floatLayer = document.getElementById("floatLayer");

  const fxCanvas = document.getElementById("fx");
  const fxCtx = fxCanvas.getContext("2d");

  let armed = false;
  let revealed = false;

  /**********************
   * 3) ê·€ì—¬ìš´ ì•„ê¸° SVG (ê°„ë‹¨, íŒŒì¼ ì—†ì´ ë‚´ì¥)
   **********************/
  function babySvg(theme){
    const isPrince = theme === "prince";
    const hat = isPrince ? "#60a5fa" : "#f472b6";
    const cheek = isPrince ? "#93c5fd" : "#fda4af";

    return `
      <svg width="220" height="160" viewBox="0 0 220 160" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="baby">
        <defs>
          <filter id="s" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="10" stdDeviation="8" flood-color="rgba(0,0,0,.14)"/>
          </filter>
        </defs>

        <!-- body -->
        <g filter="url(#s)">
          <path d="M40 118c10-30 35-48 70-48s60 18 70 48c-22 20-47 32-70 32s-48-12-70-32Z" fill="#fff"/>
          <path d="M52 120c18 16 38 24 58 24s40-8 58-24" stroke="rgba(0,0,0,.06)" stroke-width="6" stroke-linecap="round"/>
        </g>

        <!-- head -->
        <g filter="url(#s)">
          <circle cx="110" cy="62" r="44" fill="#fff"/>
          <circle cx="92" cy="70" r="7" fill="${cheek}" opacity="0.55"/>
          <circle cx="128" cy="70" r="7" fill="${cheek}" opacity="0.55"/>
          <circle cx="94" cy="60" r="5" fill="#111827"/>
          <circle cx="126" cy="60" r="5" fill="#111827"/>
          <path d="M101 79c7 7 11 7 18 0" stroke="#111827" stroke-width="4" stroke-linecap="round"/>
        </g>

        <!-- hat -->
        <g filter="url(#s)">
          <path d="M70 44c18-22 62-22 80 0c-10 6-26 10-40 10S80 50 70 44Z" fill="${hat}"/>
          <circle cx="110" cy="34" r="8" fill="${hat}"/>
        </g>

        <!-- tiny stars -->
        <g opacity="0.9">
          <path d="M24 38l4 10l10 4l-10 4l-4 10l-4-10l-10-4l10-4l4-10Z" fill="${hat}" opacity="0.55"/>
          <path d="M190 28l3 8l8 3l-8 3l-3 8l-3-8l-8-3l8-3l3-8Z" fill="${hat}" opacity="0.55"/>
        </g>
      </svg>
    `;
  }

  /**********************
   * 4) ë– ë‹¤ë‹ˆëŠ” ì´ëª¨ì§€(íŒŒí‹° ë¶„ìœ„ê¸°)
   **********************/
  const PARTY_EMOJIS = ["ğŸ†","ğŸ‡","âœ¨","ğŸ’–","ğŸ’«","ğŸ‰","ğŸ«§"];
  function spawnSpark(){
    if(!armed || revealed) return;
    const el = document.createElement("div");
    el.className = "spark";
    el.textContent = PARTY_EMOJIS[Math.floor(Math.random()*PARTY_EMOJIS.length)];
    const x = Math.random()*100;
    el.style.left = x + "%";
    el.style.bottom = "-10px";
    el.style.animationDuration = (2.2 + Math.random()*1.2) + "s";
    floatLayer.appendChild(el);
    setTimeout(()=> el.remove(), 3200);
  }
  let sparkTimer = null;

  /**********************
   * 5) í­ì£½(ê°„ë‹¨ íŒŒí‹°í´)
   **********************/
  function resizeFx(){
    fxCanvas.width = window.innerWidth * devicePixelRatio;
    fxCanvas.height = window.innerHeight * devicePixelRatio;
    fxCanvas.style.width = window.innerWidth + "px";
    fxCanvas.style.height = window.innerHeight + "px";
    fxCtx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
  }
  window.addEventListener("resize", resizeFx);
  resizeFx();

  let particles = [];
  function addBurst(x, y){
    const count = 90;
    for(let i=0;i<count;i++){
      const a = Math.random() * Math.PI * 2;
      const sp = 1.5 + Math.random()*5.5;
      particles.push({
        x, y,
        vx: Math.cos(a)*sp,
        vy: Math.sin(a)*sp - (Math.random()*1.5),
        life: 70 + Math.random()*30,
        r: 2 + Math.random()*2.2,
        hue: Math.floor(Math.random()*360)
      });
    }
  }
  function fxLoop(){
    fxCtx.clearRect(0,0, window.innerWidth, window.innerHeight);

    // gentle fade trail
    fxCtx.fillStyle = "rgba(255,255,255,0.10)";
    fxCtx.fillRect(0,0, window.innerWidth, window.innerHeight);

    particles = particles.filter(p => p.life > 0);
    for(const p of particles){
      p.x += p.vx;
      p.y += p.vy;
      p.vx *= 0.985;
      p.vy *= 0.985;
      p.vy += 0.03;
      p.life -= 1;

      fxCtx.beginPath();
      fxCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      fxCtx.fillStyle = `hsla(${p.hue}, 92%, 62%, ${Math.max(0, p.life/110)})`;
      fxCtx.fill();
    }

    if(fxCanvas.classList.contains("show")){
      requestAnimationFrame(fxLoop);
    }
  }

  function startFireworks(){
    fxCanvas.classList.add("show");
    resizeFx();
    // bursts
    const w = window.innerWidth, h = window.innerHeight;
    addBurst(w*0.25, h*0.35);
    addBurst(w*0.75, h*0.32);
    setTimeout(()=>addBurst(w*0.50, h*0.25), 180);
    setTimeout(()=>addBurst(w*0.38, h*0.45), 360);
    setTimeout(()=>addBurst(w*0.62, h*0.48), 520);
    fxLoop();

    // stop after a while
    setTimeout(()=>{
      fxCanvas.classList.remove("show");
      particles = [];
      fxCtx.clearRect(0,0, w, h);
    }, 4200);
  }

  /**********************
   * 6) í”ë“¤ê¸° ê°ì§€
   **********************/
  // ë‹¨ìˆœ threshold ë°©ì‹ (ê°€ë³ê³  ì˜ ë¨¹í˜)
  let shakeScore = 0;
  let lastTime = 0;

  const SHAKE_THRESHOLD = 16; // ë¯¼ê°ë„ (ë‚®ì„ìˆ˜ë¡ ë¯¼ê°)
  const SHAKE_TARGET = 3;     // ëª‡ ë²ˆ í”ë“¤ë©´ ê³µê°œë¡œ ë³¼ì§€(ì²´ê°)

  function setStatus(msg){ statusEl.textContent = "ìƒíƒœ: " + msg; }
  function setMeter(v){
    const pct = Math.min(100, Math.max(0, v));
    meterEl.style.width = pct + "%";
  }

  function onMotion(e){
    if(!armed || revealed) return;
    const a = e.accelerationIncludingGravity;
    if(!a) return;

    const now = Date.now();
    if(now - lastTime < 80) return; // ë„ˆë¬´ ì¦ì€ ìƒ˜í”Œ ë°©ì§€
    lastTime = now;

    const ax = a.x || 0, ay = a.y || 0, az = a.z || 0;
    const magnitude = Math.sqrt(ax*ax + ay*ay + az*az);

    // magnitudeê°€ ì¼ì • ì´ìƒì´ë©´ í”ë“¤ê¸° ì¹´ìš´íŠ¸ ì—…
    if(magnitude > SHAKE_THRESHOLD){
      shakeScore += 1;
      const pct = (shakeScore / SHAKE_TARGET) * 100;
      setMeter(pct);
      setStatus(`í”ë“¤ê¸° ê°ì§€! (${shakeScore}/${SHAKE_TARGET})`);
      // íŒŒí‹° ì´ëª¨ì§€
      spawnSpark();

      if(shakeScore >= SHAKE_TARGET){
        doReveal();
      }
    } else {
      // ì‚´ì§ ì²œì²œíˆ ì¤„ì–´ë“¤ê²Œ
      shakeScore = Math.max(0, shakeScore - 0.2);
      setMeter((shakeScore / SHAKE_TARGET) * 100);
    }
  }

  async function requestMotionPermissionIfNeeded(){
    // iOS 13+ requires permission
    const D = window.DeviceMotionEvent;
    if(!D) return { ok:false, reason:"ì´ ê¸°ê¸°ëŠ” í”ë“¤ê¸° ì„¼ì„œë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ìš”." };

    if(typeof D.requestPermission === "function"){
      try{
        const res = await D.requestPermission();
        if(res !== "granted"){
          return { ok:false, reason:"ëª¨ì…˜ ê¶Œí•œì´ í•„ìš”í•´ìš”. (ì„¤ì •ì—ì„œ í—ˆìš© ê°€ëŠ¥)" };
        }
      }catch(err){
        return { ok:false, reason:"ëª¨ì…˜ ê¶Œí•œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”." };
      }
    }
    return { ok:true };
  }

  function arm(){
    if(armed) return;
    armed = true;
    revealed = false;
    shakeScore = 0;
    setMeter(0);
    setStatus("í”ë“¤ì–´ ë³´ì„¸ìš”!");
    window.addEventListener("devicemotion", onMotion, { passive:true });

    // ë¶„ìœ„ê¸°ìš© spark ìë™ ìƒì„±(ì•„ì£¼ ì•½í•˜ê²Œ)
    sparkTimer = setInterval(spawnSpark, 420);
  }

  function disarm(){
    armed = false;
    window.removeEventListener("devicemotion", onMotion);
    if(sparkTimer) clearInterval(sparkTimer);
    sparkTimer = null;
  }

  function doReveal(){
    if(revealed) return;
    revealed = true;
    disarm();

    const result = REVEAL_RESULT;
    answerText.textContent = LABELS[result] || "ê³µê°œ!";
    answerText.classList.toggle("prince", result === "prince");
    answerText.classList.toggle("princess", result === "princess");

    babyArt.innerHTML = babySvg(result);
    noteEl.textContent = (result === "prince")
      ? "ìš°ë¦¬ ì§‘ì— â€˜ì™•ìë‹˜â€™ì´ ì°¾ì•„ì™”ì–´ìš” ğŸ’™"
      : "ìš°ë¦¬ ì§‘ì— â€˜ê³µì£¼ë‹˜â€™ì´ ì°¾ì•„ì™”ì–´ìš” ğŸ’–";

    placeholder.style.display = "none";
    revealEl.classList.add("show");

    // í­ì£½!
    startFireworks();

    // ì‘ì€ ì§„ë™ (ì§€ì› ê¸°ê¸°)
    try { navigator.vibrate?.([70, 50, 90]); } catch {}
  }

  function resetAll(){
    disarm();
    revealed = false;
    shakeScore = 0;
    setMeter(0);
    setStatus("ëŒ€ê¸° ì¤‘");
    revealEl.classList.remove("show");
    placeholder.style.display = "block";
    floatLayer.innerHTML = "";
  }

  /**********************
   * 7) ë²„íŠ¼ ì´ë²¤íŠ¸
   **********************/
  btnStart.addEventListener("click", async ()=>{
    const perm = await requestMotionPermissionIfNeeded();
    if(!perm.ok){
      setStatus(perm.reason);
      alert(perm.reason);
      return;
    }
    resetAll();
    arm();
  });

  btnTest.addEventListener("click", ()=>{
    // ì‹œì‘ ì—†ì´ë„ ê³µê°œ í…ŒìŠ¤íŠ¸
    resetAll();
    doReveal();
  });

  btnReset.addEventListener("click", ()=>{
    resetAll();
  });

  // ì´ˆê¸° ìƒíƒœ
  resetAll();
</script>
</body>
</html>
