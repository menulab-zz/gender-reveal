<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ï∫°Ìã¥Ïù¥ Ï††ÎçîÎ¶¨Îπå ‚Äî Ïä§ÌÅ¨ÎûòÏπò</title>
  <meta name="theme-color" content="#fff0f6" />
  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#f2f8ff;
      --card:#ffffffcc;
      --text:#111827;
      --muted:#6b7280;
      --accent:#ff4d8d;
      --shadow: 0 20px 60px rgba(0,0,0,.12);
      --radius: 22px;
      font-family: "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100svh;
      background:
        radial-gradient(1100px 700px at 20% 10%, var(--bg1), transparent 60%),
        radial-gradient(1100px 700px at 80% 20%, var(--bg2), transparent 60%),
        linear-gradient(180deg, #fff, #fff);
      color:var(--text);
      display:flex;
      justify-content:center;
      padding: 26px 16px 40px;
      overflow-x:hidden;
    }
    .wrap{
      width: 100%;
      max-width: 880px;
    }
    .title{
      text-align:center;
      font-weight: 1000;
      font-size: 22px;
      letter-spacing: -.02em;
      margin: 6px 0 14px;
      line-height: 1.35;
    }
    .card{
      background: var(--card);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }
    .scratchBox{
      position:relative;
      width: 100%;
      aspect-ratio: 16 / 10;
      min-height: 320px;
      background: #f8fafc;
    }
    @media (max-width: 520px){
      .scratchBox{ min-height: 300px; aspect-ratio: 4 / 3; }
    }

    /* Under layer (prize) */
    .prize{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding: 18px 16px 22px;
      text-align:center;
    }
    .winText{
      font-size: 44px;
      font-weight: 1100;
      margin: 0 0 12px;
      letter-spacing: -.03em;
      background: linear-gradient(90deg,#ff6ea3,#ffb3d1);
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      text-shadow: 0 14px 30px rgba(0,0,0,.08);
      display:none;
    }
    .winText.show{ display:block; }

    .babyImg{
      width: min(520px, 92%);
      max-height: 62%;
      object-fit: contain;
      border-radius: 16px;
      box-shadow:0 16px 40px rgba(0,0,0,.12);
      border: 1px solid rgba(0,0,0,.06);
      display:none;
      background:#fff;
      position:relative;
      z-index: 2; /* keep above sparkles */
    }
    .babyImg.show{ display:block; }

    .subText{
      margin: 12px 0 0;
      color: var(--muted);
      font-size: 15px;
      font-weight: 700;
      display:none;
      position:relative;
      z-index:2;
    }
    .subText.show{ display:block; }

    /* Scratch canvas layer */
    #scratchCanvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      touch-action:none;
      z-index: 1;
    }

    /* Top hint overlay (before reveal) */
    .scratchHint{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
      z-index: 2;
    }
    .scratchHintInner{
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.40);
      border: 1px dashed rgba(255,255,255,.8);
      color: rgba(255,255,255,.95);
      font-weight: 1000;
      letter-spacing: -.01em;
      text-shadow: 0 8px 20px rgba(0,0,0,.22);
    }

    /* Fireworks canvas (keep behind the card so it never covers image) */
    #fx{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 0;     /* behind everything */
      display:none;
    }
    #fx.show{ display:block; }

    /* Floating sparkles (also behind image) */
    .spark{
      position:absolute;
      font-size: 18px;
      opacity:.9;
      animation: rise 2.6s linear forwards;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.12));
      pointer-events:none;
      z-index: 0; /* behind baby image */
    }
    @keyframes rise{
      0%{ transform: translateY(0) scale(1); opacity:0; }
      12%{ opacity:.95; }
      100%{ transform: translateY(-240px) scale(1.15); opacity:0; }
    }

    .footer{
      text-align:center;
      color: var(--muted);
      font-size: 12px;
      margin-top: 12px;
      user-select:none;
    }

    .actions{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    .btn{
      appearance:none;
      border:none;
      border-radius: 14px;
      padding: 11px 14px;
      font-weight: 1000;
      cursor:pointer;
      background: #111827;
      color: #fff;
      transition: transform .08s ease, opacity .2s ease;
    }
    .btn:active{ transform: scale(.98); }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>

  <div class="wrap">
    <div class="title">Ï∫°Ìã¥Ïù¥Ïùò ÏÑ±Î≥ÑÏù¥ Í∂ÅÍ∏àÌïúÍ∞ÄÏöî?</div>

    <div class="card">
      <div class="scratchBox" id="scratchBox">
        <!-- Under layer (prize) -->
        <div class="prize" aria-live="polite">
          <div class="winText" id="winText">Í≥µÏ£ºÎãò! ÏûÖÎãàÎã§ üíñ</div>
          <img class="babyImg" id="babyImg" src="baby.png" alt="ÏïÑÍ∏∞ Ïù¥ÎØ∏ÏßÄ" />
          <p class="subText" id="subText">Ïö∞Î¶¨ Í∞ÄÏ°±ÏóêÍ≤å ÏÉàÎ°úÏö¥ Í∏∞ÏÅ®Ïù¥ Ï∞æÏïÑÏôîÏñ¥Ïöî.</p>
        </div>

        <!-- Scratch cover -->
        <canvas id="scratchCanvas" aria-label="Ïä§ÌÅ¨ÎûòÏπò ÏòÅÏó≠"></canvas>

        <!-- Visual hint on top -->
        <div class="scratchHint" id="scratchHint">
          <div class="scratchHintInner">üëÜ Ïó¨Í∏∞ Í∏ÅÍ∏∞</div>
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn" id="resetBtn" type="button">Îã§Ïãú ÌïòÍ∏∞</button>
    </div>

    <div class="footer">ÌåÅ: ÏÜêÍ∞ÄÎùΩÏúºÎ°ú Ïó¨Îü¨ Î≤à ÏÇ¥ÏÇ¥ Î¨∏ÏßÄÎ•¥Î©¥ Î≥µÍ∂åÏ≤òÎüº Ïûò Î≤óÍ≤®Ï†∏Ïöî ‚ú®</div>
  </div>

  <script>
    /**********************
     * Scratch settings
     **********************/
    const RADIUS = 28;             // Î∏åÎü¨Ïãú ÌÅ¨Í∏∞
    const CLEAR_THRESHOLD = 0.55;  // 55% Ïù¥ÏÉÅ Í∏ÅÏúºÎ©¥ Í≥µÍ∞ú (Î≥µÍ∂å ÎäêÎÇå)
    const COVER_COLOR = "#B9B1C9"; // Ïä§ÌÅ¨ÎûòÏπò ÏΩîÌåÖ ÏÉâ

    const canvas = document.getElementById("scratchCanvas");
    const box = document.getElementById("scratchBox");
    const hint = document.getElementById("scratchHint");

    const winText = document.getElementById("winText");
    const babyImg = document.getElementById("babyImg");
    const subText = document.getElementById("subText");
    const resetBtn = document.getElementById("resetBtn");

    let ctx;
    let drawing = false;
    let lastX = 0, lastY = 0;
    let revealed = false;

    /**********************
     * Sparkles + fireworks
     * - Must NOT cover baby image: keep behind the card / behind image
     **********************/
    const SPARKS = ["‚ú®","üéÜ","üéá","üíñ","üí´","üéâ","ü´ß"];
    function spawnSpark(){
      if(revealed) return;
      const el = document.createElement("div");
      el.className = "spark";
      el.textContent = SPARKS[Math.floor(Math.random()*SPARKS.length)];
      el.style.left = (10 + Math.random()*80) + "%";
      el.style.bottom = "-10px";
      el.style.animationDuration = (2.1 + Math.random()*1.2) + "s";
      box.appendChild(el);
      setTimeout(()=> el.remove(), 3200);
    }

    // Fireworks (simple particles) behind everything (fx canvas z-index 0)
    const fxCanvas = document.getElementById("fx");
    const fxCtx = fxCanvas.getContext("2d");
    let particles = [];
    function resizeFx(){
      fxCanvas.width = window.innerWidth * devicePixelRatio;
      fxCanvas.height = window.innerHeight * devicePixelRatio;
      fxCanvas.style.width = window.innerWidth + "px";
      fxCanvas.style.height = window.innerHeight + "px";
      fxCtx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
    }
    window.addEventListener("resize", resizeFx);
    resizeFx();

    function addBurst(x, y){
      const count = 90;
      for(let i=0;i<count;i++){
        const a = Math.random() * Math.PI * 2;
        const sp = 1.8 + Math.random()*5.8;
        particles.push({
          x, y,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp - (Math.random()*1.6),
          life: 70 + Math.random()*30,
          r: 2 + Math.random()*2.2,
          hue: Math.floor(Math.random()*360)
        });
      }
    }
    function fxLoop(){
      fxCtx.clearRect(0,0, window.innerWidth, window.innerHeight);

      particles = particles.filter(p => p.life > 0);
      for(const p of particles){
        p.x += p.vx;
        p.y += p.vy;
        p.vx *= 0.985;
        p.vy *= 0.985;
        p.vy += 0.03;
        p.life -= 1;

        fxCtx.beginPath();
        fxCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        fxCtx.fillStyle = `hsla(${p.hue}, 92%, 62%, ${Math.max(0, p.life/110)})`;
        fxCtx.fill();
      }
      if(fxCanvas.classList.contains("show")){
        requestAnimationFrame(fxLoop);
      }
    }

    function startFireworks(){
      fxCanvas.classList.add("show");
      resizeFx();
      const w = window.innerWidth, h = window.innerHeight;

      // Bursts away from center-ish so it doesn't visually "sit" on the card
      addBurst(w*0.15, h*0.22);
      addBurst(w*0.85, h*0.20);
      setTimeout(()=>addBurst(w*0.50, h*0.12), 180);
      setTimeout(()=>addBurst(w*0.25, h*0.40), 360);
      setTimeout(()=>addBurst(w*0.75, h*0.42), 520);

      fxLoop();
      setTimeout(()=>{
        fxCanvas.classList.remove("show");
        particles = [];
        fxCtx.clearRect(0,0, w, h);
      }, 3800);
    }

    /**********************
     * Scratch implementation
     **********************/
    function fitCanvas(){
      const rect = box.getBoundingClientRect();
      canvas.width = rect.width * devicePixelRatio;
      canvas.height = rect.height * devicePixelRatio;
      canvas.style.width = rect.width + "px";
      canvas.style.height = rect.height + "px";

      ctx = canvas.getContext("2d");
      ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);

      // cover fill
      ctx.globalCompositeOperation = "source-over";
      ctx.fillStyle = COVER_COLOR;
      ctx.fillRect(0,0,rect.width,rect.height);

      // add subtle pattern/text
      ctx.fillStyle = "rgba(255,255,255,0.18)";
      ctx.font = '1000 34px "Noto Sans KR", sans-serif';
      ctx.textAlign = "center";
      ctx.fillText("SCRATCH", rect.width/2, rect.height/2 - 6);
      ctx.font = '900 16px "Noto Sans KR", sans-serif';
      ctx.fillText("Ïó¨Í∏∞Î•º Í∏ÅÏñ¥Ï£ºÏÑ∏Ïöî", rect.width/2, rect.height/2 + 22);

      // switch to eraser mode
      ctx.globalCompositeOperation = "destination-out";
      ctx.fillStyle = "rgba(0,0,0,1)";
    }

    function erase(x,y){
      ctx.beginPath();
      ctx.arc(x,y,RADIUS,0,Math.PI*2);
      ctx.fill();
    }

    function getPos(e){
      const rect = box.getBoundingClientRect();
      const clientX = (e.touches?.[0]?.clientX ?? e.clientX);
      const clientY = (e.touches?.[0]?.clientY ?? e.clientY);
      return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function down(e){
      if(revealed) return;
      drawing = true;
      const p = getPos(e);
      lastX = p.x; lastY = p.y;
      erase(lastX, lastY);
      hint.style.display = "none";
      if(Math.random() < 0.5) spawnSpark();
    }

    function move(e){
      if(!drawing || revealed) return;
      const p = getPos(e);
      const dx = p.x - lastX, dy = p.y - lastY;
      const dist = Math.hypot(dx,dy);
      const step = Math.max(1, Math.floor(dist / (RADIUS/2)));
      for(let i=0;i<=step;i++){
        const ix = lastX + dx*(i/step);
        const iy = lastY + dy*(i/step);
        erase(ix,iy);
      }
      lastX = p.x; lastY = p.y;
      if(Math.random() < 0.12) spawnSpark();
    }

    function up(){
      if(!drawing) return;
      drawing = false;
      requestAnimationFrame(checkClearPercent);
    }

    function checkClearPercent(){
      if(revealed) return;
      try{
        const sampleScale = 8;
        const sw = Math.max(24, Math.floor(canvas.width / sampleScale));
        const sh = Math.max(24, Math.floor(canvas.height / sampleScale));
        const small = document.createElement("canvas");
        small.width = sw;
        small.height = sh;
        const sctx = small.getContext("2d");
        sctx.drawImage(canvas, 0, 0, sw, sh);
        const data = sctx.getImageData(0,0,sw,sh).data;

        let cleared = 0;
        const total = sw * sh;
        for(let i=0;i<data.length;i+=4){
          if(data[i+3] === 0) cleared++;
        }
        const ratio = cleared / total;
        if(ratio >= CLEAR_THRESHOLD){
          reveal();
        }
      }catch(err){
        console.warn("checkClearPercent error", err);
      }
    }

    function reveal(){
      if(revealed) return;
      revealed = true;

      // fully clear canvas
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // show prize
      winText.classList.add("show");
      babyImg.classList.add("show");
      subText.classList.add("show");

      // fireworks behind the card
      startFireworks();

      // sparkles burst (behind image)
      for(let i=0;i<14;i++){
        setTimeout(spawnSpark, i*90);
      }

      // tiny vibration
      try { navigator.vibrate?.([70, 50, 90]); } catch {}
    }

    function resetAll(){
      revealed = false;
      hint.style.display = "flex";
      winText.classList.remove("show");
      babyImg.classList.remove("show");
      subText.classList.remove("show");
      fitCanvas();
    }

    function attach(){
      canvas.addEventListener("pointerdown", (e)=>{ e.preventDefault(); canvas.setPointerCapture(e.pointerId); down(e); }, {passive:false});
      canvas.addEventListener("pointermove", (e)=>{ if(e.buttons === 1) move(e); }, {passive:false});
      canvas.addEventListener("pointerup", (e)=>{ canvas.releasePointerCapture?.(e.pointerId); up(); }, {passive:true});
      canvas.addEventListener("pointercancel", up);

      canvas.addEventListener("touchstart", (e)=>{ e.preventDefault(); down(e); }, {passive:false});
      canvas.addEventListener("touchmove", (e)=>{ e.preventDefault(); move(e); }, {passive:false});
      canvas.addEventListener("touchend", up, {passive:true});

      resetBtn.addEventListener("click", resetAll);
      window.addEventListener("resize", ()=> setTimeout(fitCanvas, 120));
    }

    function init(){
      fitCanvas();
      attach();
      setInterval(()=>{ if(!revealed && Math.random()<0.55) spawnSpark(); }, 520);
    }

    window.addEventListener("load", init);
  </script>
</body>
</html>
